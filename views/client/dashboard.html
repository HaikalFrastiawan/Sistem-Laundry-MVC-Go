<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Member Area | Sistem Laundry</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        body { background-color: #f3f4f6; }
        .hero-card {
            background: linear-gradient(135deg, #4f46e5, #818cf8);
            color: white;
            border-radius: 15px;
        }
        .status-tracker { border-left: 4px solid #4f46e5; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="#">Sistem Laundry</a>
            <div class="d-flex">
                <span class="me-3 align-self-center text-muted">Halo, <b>{{ .customerName }}</b></span>
                <a href="/logout" class="btn btn-outline-danger btn-sm">Keluar</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">

        <div class="card hero-card shadow-sm mb-4 border-0">
            <div class="card-body p-4 d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="fw-bold">Mau nyuci apa hari ini?</h2>
                    <p class="mb-0 opacity-75">Kami jemput, kami cuci, kami antar kembali.</p>
                </div>
                <button type="button" class="btn btn-light text-primary fw-bold px-4 py-2" data-bs-toggle="modal" data-bs-target="#orderModal">
                    <i class="bi bi-basket-fill"></i> Buat Pesanan Baru
                </button>
            </div>
        </div>

        <div class="row">
<div class="col-md-7">
    <h5 class="fw-bold mb-3"><i class="bi bi-truck"></i> Lacak Pesanan</h5>
    
    {{ range .activeOrders }}
    <div class="card border-0 shadow-sm mb-3 status-tracker">
        <div class="card-body">
            <div class="d-flex justify-content-between mb-2">
                {{ if eq .Status "Pending" }}
                <span class="badge bg-secondary text-white">Menunggu Kurir</span>
                {{ else if eq .Status "Cuci" }}
                <span class="badge bg-warning text-dark">Sedang Dicuci</span>
                {{ else if eq .Status "Setrika" }}
                <span class="badge bg-info text-dark">Sedang Disetrika</span>
                {{ end }}

                <small class="text-muted">No. Order #ORD-{{ .ID }}</small>
            </div>
            
            <h6 class="fw-bold">{{ .Service.Name }}</h6>
            <p class="text-muted small mb-2">Berat: {{ .Weight }} Kg • <b>Total: Rp {{ .TotalPrice }}</b></p>
            
            <div class="progress" style="height: 6px;">
                {{ if eq .Status "Pending" }}
                <div class="progress-bar bg-primary" role="progressbar" style="width: 20%"></div>
                {{ else if eq .Status "Cuci" }}
                <div class="progress-bar bg-primary" role="progressbar" style="width: 60%"></div>
                {{ else if eq .Status "Setrika" }}
                <div class="progress-bar bg-primary" role="progressbar" style="width: 85%"></div>
                {{ end }}
            </div>
            
            <div class="d-flex justify-content-between mt-1" style="font-size: 0.75rem;">
                <span class="{{ if eq .Status "Pending" }}fw-bold text-primary{{ end }}">Penjemputan</span>
                <span class="{{ if eq .Status "Cuci" }}fw-bold text-primary{{ end }}">Proses Cuci</span>
                <span class="{{ if eq .Status "Setrika" }}fw-bold text-primary{{ end }}">Pengantaran</span>
            </div>
        </div>
    </div>
    {{ else }}
    <div class="alert alert-light text-center border-0 shadow-sm">
        <img src="https://cdn-icons-png.flaticon.com/512/2038/2038854.png" width="50" class="mb-2 opacity-50">
        <p class="mb-0 text-muted small">Tidak ada pesanan aktif saat ini.</p>
    </div>
    {{ end }}
</div>

            <div class="col-md-5">
                <h5 class="fw-bold mb-3"><i class="bi bi-clock-history"></i> Riwayat Terakhir</h5>
                <div class="card border-0 shadow-sm">
                    <div class="list-group list-group-flush">
                        
                        {{ range .history }}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ .Service.Name }}</h6>
                                <small class="text-muted">{{ .CreatedAt.Format "02 Jan" }}</small>
                            </div>
                            <p class="mb-1 small">Rp {{ .TotalPrice }} • {{ .Weight }} Kg</p>
                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Selesai</small>
                        </div>
                        {{ end }}

                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">Setrika Saja</h6>
                                <small class="text-muted">15 Jan</small>
                            </div>
                            <p class="mb-1 small">Rp 15.000 • 3 Kg</p>
                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Selesai</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold text-primary"><i class="bi bi-basket"></i> Buat Pesanan Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">Pilih jenis layanan dan estimasi berat cucian Anda.</p>
                    
                    <form action="/client/order/create" method="POST">
                        <div class="mb-3">
                            <label class="form-label fw-bold small">Layanan</label>
                            <select class="form-select" name="service_id" id="serviceSelect" required>
                                <option value="" selected disabled>Pilih Layanan...</option>
                                {{ range .services }}
                                <option value="{{ .ID }}" data-price="{{ .PricePerKg }}">{{ .Name }} - Rp {{ .PricePerKg }}/kg</option>
                                {{ end }}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small">Estimasi Berat (Kg)</label>
                            <input type="number" class="form-control" name="weight" id="weightInput" placeholder="Contoh: 3" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold small">Metode Pengambilan</label>
                            <select class="form-select" name="delivery">
                                <option value="pickup">Diantar Kurir (+ Rp 5.000)</option>
                                <option value="self">Ambil Sendiri (Gratis)</option>
                            </select>
                        </div>

                        <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded mb-3">
                            <span class="text-muted">Total Estimasi:</span>
                            <h4 class="fw-bold text-primary mb-0" id="totalPrice">Rp 0</h4>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">Konfirmasi Pesanan</button>
                            <button type="button" class="btn btn-light text-muted" data-bs-dismiss="modal">Batal</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const serviceSelect = document.getElementById('serviceSelect');
        const weightInput = document.getElementById('weightInput');
        const totalPriceDisplay = document.getElementById('totalPrice');

        function calculateTotal() {
            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            const pricePerKg = selectedOption.getAttribute('data-price') || 0;
            const weight = weightInput.value || 0;
            
            const total = pricePerKg * weight;
            totalPriceDisplay.innerText = "Rp " + total.toLocaleString('id-ID');
        }

        serviceSelect.addEventListener('change', calculateTotal);
        weightInput.addEventListener('input', calculateTotal);
    </script>
</body>
</html>